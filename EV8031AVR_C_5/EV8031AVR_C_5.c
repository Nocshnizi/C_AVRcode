#define F_CPU 7372800L //??????? ??????? ?????? (7,3728 ???)
#include <avr/io.h>
#include <avr/iom8515.h>
#include <avr/interrupt.h>
#include <util/delay.h>

//??????? ????????? - ?????? ???????? ?????? ? ???
#define lcd_comm 0x8004
//??????? ????????? - ?????? ???????? ????? ? ???
#define lcd_data 0x8005


//???????? ???? ?????? ?????????? ? ????????? ???????????? ???????????
  volatile unsigned char attribute = 0xFF;
//???????? ????????? ???????? ??? ????????
  volatile unsigned char first_num = 0x30; 
volatile unsigned char second_num = 0x30; 
volatile unsigned char third_num = 0x30; 
 

//??????????? IRQ0 (?? ????? INT0)
  ISR(INT0_vect){
    attribute = 0xFF; //????????? ??????? ?????? ?????
  }

//??????????? IRQ1 (?? ????? INT1)
  ISR(INT1_vect){
    attribute = 0x00; //????????? ??????? ?????? ????
  }

int main(void) {

//???????????? ????????? ?? ?????? ???????? ?????? ???

  volatile unsigned char* c = (unsigned char *) lcd_comm;

//???????????? ????????? ?? ?????? ???????? ????? ???

  volatile unsigned char* d = (unsigned char *) lcd_data;

 
//????????? ????????????? ??????????

  ACSR= 1<<ACD; 
//?????????? ?????? ?? ?????????? ???'???? ? ???????????? ???????? ???????????


  MCUCR = 1 << SRE | 1<< ISC11 | 1<< ISC10 | 1<<ISC01 | 0<<ISC00;
//???????????: INT1 ???????????? ?? ?????, ? INT0 - ?? ???????? ?????
//?? ??????????? ??????? (???? 0, 1 (ISC00, ISC01) ?? 2, 3 (ISC10, ISC11) ???????)


  GICR = 1 << INT0 | 1<<INT1;


  *c = 0x38; //Function Set
  _delay_ms (10); 
  *c = 0x0E; //Display ON/OFF Control
  _delay_ms (10); 

  *c = 0x01; //Display clear first position first row
  _delay_ms (10); 

  *c = 0x06; //Entry Mode Set
  _delay_ms (10); 


  sei();

  while(1) {
//????????? ???????? ???????-?????? ?? ?????? ????????? ??? ?? ???????????
    if(attribute== 0xFF) {  
        
      if(third_num < 0x39)//?????????? ?? ??????? ????? ????? 9
    {
    third_num ++;//???? ???, ?? ??????? 1
    }
    else if (second_num < 0x39)//??????????? ???? ????? ????? ????? 9-??
    {
    third_num= 0x30;//???? ??? ????? ????? ???? 0
    second_num ++;//????? ????? ???????????? ?? 1
    }
    else if (first_num < 0x39 ) //??????????? ???? ????? ????? ????? 9-??

    {
    third_num= 0x30;//???? ??? ????? ????? 0
    second_num =0x30;//????? ????? 0
    first_num++;//??????? ?? ??????? ????? 1
    }
    else  if(second_num == 0x39 & first_num== 0x39)//???? ?? ???? ????? ?? ?????????? ? ????? ?? ????? ????? ???????? 9
    {
      third_num= 0x30;//??? ????? ?????????? ? 0
    	second_num =0x30;
    	first_num= 0x30;
    }
      

    } else {//???? ?? ????? ?? ?????? ???????

    if(third_num > 0x30)//??????????? ???? ????? ????? ?????? 0
    {
    	third_num --;//???? ???, ?? ?????????? 1
    }
    else if (second_num > 0x30)//???? ????? ?? ??????????, ??????????? ?? ????? ????? ?????? 0
    {
    	third_num= 0x39;//???? ???, ???? ????? ????? ???? 9
    	second_num --;//?? ????????? ????? ?????
    }
    else if (first_num> 0x30 )//???? ? ????? ????? 0, ??????????? ?? ????? ????? 0
    {
    	third_num= 0x39;//???? ???, ????? ????? ???? 9
    	second_num =0x39;//????? ????? ????? 9
    	first_num--;//????? ????????? ?? 1
    }
    else if(first_num == 0x30 & second_num == 0x30)//??? ????? ?? ??? ????? 0
    {
      third_num= 0x39; //??????? ??? ????? ?? 9
    	second_num =0x39;
    	first_num= 0x39;
    }
            
    }

    
    
    *d = first_num;//???????? ????? ????? ?? ???

    _delay_ms(200);

    *d = second_num;

    _delay_ms(200);

    *d = third_num;

    _delay_ms(200);

 	 *c = 0b000000001; //cursor to home
 	 _delay_ms (10); 
	

  }
  return 0;
}
